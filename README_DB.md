# Configuração do Banco de Dados (Supabase)

Para utilizar o Supabase como backend, execute o seguinte script na aba **SQL Editor** do seu projeto Supabase.

Isso criará a estrutura completa para suportar Clientes, Operações, Recebimentos e Usuários.

```sql
-- 1. Limpeza (Opcional - remove tabelas existentes para recriar do zero)
DROP TABLE IF EXISTS receipts;
DROP TABLE IF EXISTS operations;
DROP TABLE IF EXISTS clients;
DROP TABLE IF EXISTS users;

-- 2. Tabela de Usuários
CREATE TABLE users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  papel TEXT NOT NULL CHECK (papel IN ('Administrador', 'Operador', 'Analista')),
  password TEXT NOT NULL, -- Em produção, considere usar o Supabase Auth
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 3. Tabela de Clientes
CREATE TABLE clients (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  nome TEXT NOT NULL,
  cpf_cnpj TEXT UNIQUE NOT NULL,
  email TEXT,
  telefone TEXT,
  endereco TEXT,
  limite_credito NUMERIC(15, 2) DEFAULT 0,
  taxa_juros_mensal NUMERIC(5, 2) DEFAULT 0,
  data_cadastro TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 4. Tabela de Operações
CREATE TABLE operations (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  client_id BIGINT REFERENCES clients(id) ON DELETE CASCADE NOT NULL,
  type TEXT NOT NULL CHECK (type IN ('duplicata', 'cheque')),
  title_number TEXT NOT NULL,
  nominal_value NUMERIC(15, 2) NOT NULL,
  net_value NUMERIC(15, 2) NOT NULL,
  issue_date DATE NOT NULL,
  due_date DATE NOT NULL,
  taxa NUMERIC(5, 2) NOT NULL,
  status TEXT NOT NULL CHECK (status IN ('aberto', 'pago', 'atrasado')) DEFAULT 'aberto',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 5. Tabela de Recebimentos
CREATE TABLE receipts (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  operation_id BIGINT REFERENCES operations(id) ON DELETE CASCADE NOT NULL,
  data_recebimento DATE NOT NULL,
  valor_total_recebido NUMERIC(15, 2) NOT NULL,
  valor_principal_pago NUMERIC(15, 2) DEFAULT 0,
  valor_juros_pago NUMERIC(15, 2) DEFAULT 0,
  forma_pagamento TEXT NOT NULL CHECK (forma_pagamento IN ('pix', 'boleto', 'transferencia')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- 6. Habilitar Row Level Security (RLS)
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE clients ENABLE ROW LEVEL SECURITY;
ALTER TABLE operations ENABLE ROW LEVEL SECURITY;
ALTER TABLE receipts ENABLE ROW LEVEL SECURITY;

-- 7. Criar Políticas de Acesso (Permitir tudo para API Pública/Anon por enquanto)
-- NOTA: Em produção, você deve restringir isso apenas a usuários autenticados.

CREATE POLICY "Acesso total a users" ON users FOR ALL USING (true);
CREATE POLICY "Acesso total a clients" ON clients FOR ALL USING (true);
CREATE POLICY "Acesso total a operations" ON operations FOR ALL USING (true);
CREATE POLICY "Acesso total a receipts" ON receipts FOR ALL USING (true);

-- 8. Inserir Usuário Administrador Padrão
INSERT INTO users (nome, email, papel, password)
VALUES 
('Administrador', 'gestaocaribe@gmail.com', 'Administrador', 'gestaomichel10');

```

## Notas sobre Tipos de Dados

- **Monetários**: Utilizamos `NUMERIC(15, 2)` para garantir precisão em cálculos financeiros (R$).
- **Datas**: Utilizamos `DATE` para vencimentos e emissões, e `TIMESTAMP WITH TIME ZONE` para auditoria de criação.
- **Enums**: Utilizamos *Check Constraints* (ex: `CHECK (status IN ('aberto', ...))`) para garantir que apenas valores válidos sejam inseridos, compatível com os tipos do TypeScript.
